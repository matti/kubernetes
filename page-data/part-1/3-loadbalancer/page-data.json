{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-1/3-loadbalancer","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Service"}]},{"type":"element","tagName":"exercise","properties":{"name":"service-lb"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The following mess is based on:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://docs.aws.amazon.com/eks/latest/userguide/network-load-balancing.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://docs.aws.amazon.com/eks/latest/userguide/network-load-balancing.html"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.2/guide/service/annotations/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.2/guide/service/annotations/"}]}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"And that's because of"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://cloud-provider-vsphere.sigs.k8s.io/concepts/in_tree_vs_out_of_tree.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://cloud-provider-vsphere.sigs.k8s.io/concepts/in_tree_vs_out_of_tree.html"}]}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"whoami/service-lb.yml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Service\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" whoami"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"lb\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namespace"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" __NAME__\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"annotations"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" external\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-scheme"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" internet"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"facing\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-ip-address-type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" dualstack\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-nlb-target-type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ip\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-healthcheck-protocol"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" TCP\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-healthcheck-healthy-threshold"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"2\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-healthcheck-unhealthy-threshold"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"2\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-healthcheck-timeout"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"1\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-healthcheck-interval"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"10\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"true\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-target-group-attributes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" deregistration_delay.timeout_seconds=3"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"deregistration_delay.connection_termination.enabled=true"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"stickiness.enabled=false"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"load_balancing.cross_zone.enabled=true\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" whoami\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"targetPort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"8000"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" LoadBalancer"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Service will target pods where label "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"app"}]},{"type":"text","value":" equals "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"whoami"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" whoami"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"and apply. Check in Lens Network > Services"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"While waiting for AWS, test Lens service expose."}]}]},{"type":"element","tagName":"exercise","properties":{"name":"scale up"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Scale up, this time with Lens and check the load balancer"}]}]},{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"warning"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Q: Am I charged for regional AWS data-transfer when I enable cross-zone load balancing in Network Load Balancer?"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A: Yes, you will be charged for regional data transfer between Availability Zones with Network Load Balancer when cross-zone load balancing is enabled. Check the charges in the data-transfer section at Amazon EC2 On-Demand Pricing page."}]}]},{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"multiple ports"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's try adding multiple ports"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Service\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" whoami"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"lb\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namespace"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" __NAME__\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"annotations"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" external\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-scheme"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" internet"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"facing\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-ip-address-type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" dualstack\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-nlb-target-type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ip\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-healthcheck-protocol"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" TCP\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-healthcheck-healthy-threshold"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"2\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-healthcheck-unhealthy-threshold"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"2\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-healthcheck-timeout"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"1\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-healthcheck-interval"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"10\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"true\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service.beta.kubernetes.io/aws-load-balancer-target-group-attributes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" deregistration_delay.timeout_seconds=3"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"deregistration_delay.connection_termination.enabled=true"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"stickiness.enabled=false"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"load_balancing.cross_zone.enabled=true\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" whoami\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"targetPort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"8000"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"8000"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"targetPort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"8000"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" LoadBalancer"}]}]}]}]},{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"target only one pod"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can temporarily target one pod by labeling the pod and adjusting the selector"}]}]},{"type":"element","tagName":"summary","properties":{},"children":[{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Service of Type \"LoadBalancer\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Kubernetes is a standard until it's not"}]},{"type":"text","value":"\n"}]}]}]},"html":"<div><p>Service</p><exercise name='service-lb'><p>The following mess is based on:</p><ul>\n<li><a href=\"https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/\" target=\"_blank\" rel=\"noopener noreferrer\">https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/</a></li>\n<li><a href=\"https://docs.aws.amazon.com/eks/latest/userguide/network-load-balancing.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.aws.amazon.com/eks/latest/userguide/network-load-balancing.html</a></li>\n<li><a href=\"https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.2/guide/service/annotations/\" target=\"_blank\" rel=\"noopener noreferrer\">https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.2/guide/service/annotations/</a></li>\n</ul><p>And that's because of</p><ul>\n<li><a href=\"https://cloud-provider-vsphere.sigs.k8s.io/concepts/in_tree_vs_out_of_tree.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://cloud-provider-vsphere.sigs.k8s.io/concepts/in_tree_vs_out_of_tree.html</a></li>\n</ul><p><strong>whoami/service-lb.yml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> whoami<span class=\"token punctuation\">-</span>lb\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> __NAME__\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-type</span><span class=\"token punctuation\">:</span> external\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-scheme</span><span class=\"token punctuation\">:</span> internet<span class=\"token punctuation\">-</span>facing\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-ip-address-type</span><span class=\"token punctuation\">:</span> dualstack\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-nlb-target-type</span><span class=\"token punctuation\">:</span> ip\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-healthcheck-protocol</span><span class=\"token punctuation\">:</span> TCP\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-healthcheck-healthy-threshold</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2\"</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-healthcheck-unhealthy-threshold</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2\"</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-healthcheck-timeout</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1\"</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-healthcheck-interval</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"10\"</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-target-group-attributes</span><span class=\"token punctuation\">:</span> deregistration_delay.timeout_seconds=3<span class=\"token punctuation\">,</span>deregistration_delay.connection_termination.enabled=true<span class=\"token punctuation\">,</span>stickiness.enabled=false<span class=\"token punctuation\">,</span>load_balancing.cross_zone.enabled=true\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> whoami\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> LoadBalancer</code></pre></div><p>Service will target pods where label <code class=\"language-text\">app</code> equals <code class=\"language-text\">whoami</code></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> whoami</code></pre></div><p>and apply. Check in Lens Network > Services</p><p>While waiting for AWS, test Lens service expose.</p></exercise><exercise name='scale up'><p>Scale up, this time with Lens and check the load balancer</p></exercise><text-box variant=\"learningObjectives\" name=\"warning\"><p>Q: Am I charged for regional AWS data-transfer when I enable cross-zone load balancing in Network Load Balancer?</p><p>A: Yes, you will be charged for regional data transfer between Availability Zones with Network Load Balancer when cross-zone load balancing is enabled. Check the charges in the data-transfer section at Amazon EC2 On-Demand Pricing page.</p></text-box><text-box variant=\"learningObjectives\" name=\"multiple ports\"><p>Let's try adding multiple ports</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> whoami<span class=\"token punctuation\">-</span>lb\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> __NAME__\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-type</span><span class=\"token punctuation\">:</span> external\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-scheme</span><span class=\"token punctuation\">:</span> internet<span class=\"token punctuation\">-</span>facing\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-ip-address-type</span><span class=\"token punctuation\">:</span> dualstack\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-nlb-target-type</span><span class=\"token punctuation\">:</span> ip\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-healthcheck-protocol</span><span class=\"token punctuation\">:</span> TCP\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-healthcheck-healthy-threshold</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2\"</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-healthcheck-unhealthy-threshold</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2\"</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-healthcheck-timeout</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1\"</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-healthcheck-interval</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"10\"</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span>\n    <span class=\"token key atrule\">service.beta.kubernetes.io/aws-load-balancer-target-group-attributes</span><span class=\"token punctuation\">:</span> deregistration_delay.timeout_seconds=3<span class=\"token punctuation\">,</span>deregistration_delay.connection_termination.enabled=true<span class=\"token punctuation\">,</span>stickiness.enabled=false<span class=\"token punctuation\">,</span>load_balancing.cross_zone.enabled=true\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> whoami\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> LoadBalancer</code></pre></div></text-box><text-box variant=\"learningObjectives\" name=\"target only one pod\"><p>You can temporarily target one pod by labeling the pod and adjusting the selector</p></text-box><summary><ul>\n<li>Service of Type \"LoadBalancer\"</li>\n<li>Kubernetes is a standard until it's not</li>\n</ul></summary></div>","frontmatter":{"path":"/part-1/3-loadbalancer","title":"LoadBalancer"},"fileAbsolutePath":"/Users/matti/dev/kubernetes-hy.github.io/data/part-1/3-loadbalancer.md"},"allPages":{"edges":[{"node":{"id":"1cb09917-b0d2-558b-b2f2-86e195b30139","frontmatter":{"path":"/part-0/4-namespace","title":"Namespace"}}},{"node":{"id":"b1c47f2d-76e9-58d8-9a14-2b6132468171","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"12166a9a-6e11-5213-94d8-08c3f18bce09","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"f2603f2a-7d1c-577c-b6ef-cff715589ff2","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}},{"node":{"id":"24e8849f-09ad-5dc0-ada7-9ee5278ef27b","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"36b607c8-a055-5a08-91df-23b16aae595f","frontmatter":{"path":"/part-2/3-helm","title":"Helm"}}},{"node":{"id":"8467a6ee-a4e0-5f79-92f4-8876c9a97f5d","frontmatter":{"path":"/part-0/2-kubectl-config","title":"kubectl config"}}},{"node":{"id":"c9e0f1cd-5b7a-5ba6-9e29-67e519303eb1","frontmatter":{"path":"/part-1/6-hpa","title":"HorizontalPodAutoscaler"}}},{"node":{"id":"13dd60c3-9be6-5a4b-ae4f-116e6dcffdb1","frontmatter":{"path":"/part-0/3-kubectl-basics","title":"kubectl basics"}}},{"node":{"id":"0521f0d3-f635-5905-a983-8a5d07967c76","frontmatter":{"path":"/part-0/1-kubernetes","title":"Kubernetes"}}},{"node":{"id":"a263867b-5ee2-59a1-b9cc-3ffa8e0b8965","frontmatter":{"path":"/part-0/5-pod","title":"Pod"}}},{"node":{"id":"88e6deca-06c3-559e-9e64-955b3595a4e8","frontmatter":{"path":"/part-2/4-outro","title":"Outro"}}},{"node":{"id":"b329e1eb-4475-517c-aacc-00490d0d2839","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"f90b5fd3-764b-58aa-aac5-a31d337c7665","frontmatter":{"path":"/part-1/8-probes","title":"Probes"}}},{"node":{"id":"bd25e984-94a9-534b-8527-3869b6c77792","frontmatter":{"path":"/part-1/3-loadbalancer","title":"LoadBalancer"}}},{"node":{"id":"3e9c2cd8-005c-583c-9a43-901484331012","frontmatter":{"path":"/part-2/1-tools","title":"Tools"}}},{"node":{"id":"92ec0152-3175-5546-ba07-cac2e533c35d","frontmatter":{"path":"/part-2/1-storage","title":"Storage"}}},{"node":{"id":"f52cacfb-80fe-5e11-bf42-3655f4dff267","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"1b008c97-c439-59e0-aae1-3f90dbdd3f26","frontmatter":{"path":"/part-1/2-second-deploy","title":"Second Deploy"}}},{"node":{"id":"c641591d-97e5-5c9c-a217-783adff04421","frontmatter":{"path":"/part-1/4-clusterip","title":"ClusterIP"}}},{"node":{"id":"106d4be1-5856-50f7-abbd-3de06005f303","frontmatter":{"path":"/part-1/5-ingress","title":"Ingress"}}},{"node":{"id":"9b0bfc4d-44c1-575f-828f-755834c8ffc1","frontmatter":{"path":"/part-1/7-envs-secrets-configmaps","title":"Envs and Secrets and ConfigMaps"}}},{"node":{"id":"42b9f894-d34b-5677-a3db-67bf35130fca","frontmatter":{"path":"/part-1/5-statefulset","title":"StatefulSet"}}},{"node":{"id":"9d9ca5cf-d405-50f5-b561-f857d2a77c76","frontmatter":{"path":"/","title":"Homepage"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}